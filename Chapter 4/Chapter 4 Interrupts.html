<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interrupts</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .quiz-option {
            transition: background-color 0.3s, border-color 0.3s;
        }
        .correct {
            background-color: #d1fae5 !important; /* Tailwind green-100 */
            border-color: #10b981 !important; /* Tailwind green-500 */
            color: #047857; /* Tailwind green-800 */
        }
        .incorrect {
            background-color: #fee2e2 !important; /* Tailwind red-100 */
            border-color: #ef4444 !important; /* Tailwind red-500 */
            color: #b91c1c; /* Tailwind red-800 */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-3xl bg-white rounded-2xl shadow-lg p-6 md:p-8">
        <header class="mb-8 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Interrupts</h1>
            <p class="text-gray-500 mt-2">Test your knowledge of the Chapter 4.</p>
        </header>

        <div id="quiz-container" class="space-y-8">
            </div>

        <div id="results-container" class="text-center mt-10 hidden">
            <h2 id="score-text" class="text-2xl font-bold mb-4"></h2>
            <button id="redo-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300">
                Redo Quiz
            </button>
        </div>
    </div>

    <script>
        const quizData = [
    {
        "question": "What is the most accurate definition of an interrupt?",
        "options": [
            "A signal generated by software or hardware to pause the currently running process.",
            "An error in a program that causes it to crash.",
            "A routine that speeds up the processor.",
            "A memory location used for temporary storage."
        ],
        "answer": "A signal generated by software or hardware to pause the currently running process."
    },
    {
        "question": "Which of the following is an example of a hardware-generated interrupt?",
        "options": [
            "The program attempts to divide by zero.",
            "A user presses a key on the keyboard.",
            "The program's allocated time slice expires.",
            "A software application requests data from a file."
        ],
        "answer": "A user presses a key on the keyboard."
    },
    {
        "question": "What is the primary purpose of using interrupts in a computer system?",
        "options": [
            "To shut down the computer safely.",
            "To allow the processor to handle multiple tasks and events efficiently.",
            "To scan for viruses and malware.",
            "To install new device drivers."
        ],
        "answer": "To allow the processor to handle multiple tasks and events efficiently."
    },
    {
        "question": "An operating system's scheduler can use a timer to generate regular interrupts. What are these interrupts used for?",
        "options": [
            "To check the computer's temperature.",
            "To share processor time between multiple running applications.",
            "To save all open files automatically.",
            "To detect if a key on the keyboard is stuck."
        ],
        "answer": "To share processor time between multiple running applications."
    },
    {
        "question": "If multiple interrupts occur simultaneously, how does the processor typically decide which one to handle first?",
        "options": [
            "It handles them in the order they were received.",
            "It assigns each interrupt a priority level and handles the highest priority first.",
            "It handles the one that requires the least amount of memory.",
            "It processes them randomly."
        ],
        "answer": "It assigns each interrupt a priority level and handles the highest priority first."
    },
    {
        "question": "What is an Interrupt Service Routine (ISR)?",
        "options": [
            "A hardware component that generates interrupts.",
            "A set of instructions that the processor executes to handle a specific type of interrupt.",
            "A queue where pending interrupts are stored.",
            "A tool used to debug software interrupts."
        ],
        "answer": "A set of instructions that the processor executes to handle a specific type of interrupt."
    },
    {
        "question": "Which of the following would be considered a high-priority interrupt?",
        "options": [
            "A mouse click.",
            "A print job completing.",
            "A power failure warning from the power supply.",
            "A request to load a webpage."
        ],
        "answer": "A power failure warning from the power supply."
    },
    {
        "question": "What is a software interrupt (also known as a 'trap')?",
        "options": [
            "An interrupt caused by a physical hardware failure.",
            "An interrupt generated by a user pressing Ctrl-Alt-Delete.",
            "An interrupt caused by an error in a program, such as an illegal instruction.",
            "An interrupt caused by a peripheral device like a printer running out of paper."
        ],
        "answer": "An interrupt caused by an error in a program, such as an illegal instruction."
    },
    {
        "question": "When the CPU receives an interrupt, what is the very first step in the interrupt handling process?",
        "options": [
            "It immediately jumps to the Interrupt Service Routine.",
            "It finishes executing the current Fetch-Decode-Execute cycle.",
            "It checks the priority of the incoming interrupt.",
            "It saves the state of the current process."
        ],
        "answer": "It finishes executing the current Fetch-Decode-Execute cycle."
    },
    {
        "question": "After the current instruction is completed, what is the next crucial step the processor takes before servicing an interrupt?",
        "options": [
            "It disables all further interrupts.",
            "It stores the contents of the Program Counter (PC) and other registers.",
            "It sends a signal back to the device that caused the interrupt.",
            "It loads the entire operating system into cache."
        ],
        "answer": "It stores the contents of the Program Counter (PC) and other registers."
    },
    {
        "question": "What is the final step in the interrupt handling routine, after the interrupt has been serviced?",
        "options": [
            "The computer is rebooted.",
            "All interrupts are permanently disabled.",
            "The contents of the saved registers are restored, and the original process resumes.",
            "The Interrupt Service Routine is deleted from memory."
        ],
        "answer": "The contents of the saved registers are restored, and the original process resumes."
    },
    {
        "question": "A user is playing a video game while downloading a file. An interrupt is generated when the download is complete. This is an example of the OS managing...",
        "options": [
            "user interface tasks.",
            "memory allocation.",
            "input/output (I/O) operations.",
            "software errors."
        ],
        "answer": "input/output (I/O) operations."
    },
    {
        "question": "Why must the contents of the processor's registers be saved before an ISR is run?",
        "options": [
            "To free up the registers for the ISR to use.",
            "To allow the original process to be resumed correctly without losing its state.",
            "To create a backup in case of a power failure.",
            "To check the registers for any hardware faults."
        ],
        "answer": "To allow the original process to be resumed correctly without losing its state."
    },
    {
        "question": "Which component is responsible for checking for the presence of an interrupt signal at the end of each cycle?",
        "options": [
            "The Random Access Memory (RAM).",
            "The hard disk drive.",
            "The Central Processing Unit (CPU).",
            "The device driver."
        ],
        "answer": "The Central Processing Unit (CPU)."
    },
    {
        "question": "If a high-priority interrupt occurs while a lower-priority interrupt is being serviced, what will happen?",
        "options": [
            "The processor will ignore the new interrupt until the current one is finished.",
            "The system will crash due to the conflict.",
            "The processor will pause the current ISR, save its state, and handle the higher-priority interrupt.",
            "The lower-priority interrupt will be cancelled and must be resent."
        ],
        "answer": "The processor will pause the current ISR, save its state, and handle the higher-priority interrupt."
    }
];

        const quizContainer = document.getElementById('quiz-container');
        const resultsContainer = document.getElementById('results-container');
        const scoreText = document.getElementById('score-text');
        const redoBtn = document.getElementById('redo-btn');

        let score = 0;
        let questionsAnswered = 0;

        /**
         * NEW: Function to shuffle an array in place using the Fisher-Yates algorithm.
         * @param {Array} array The array to shuffle.
         * @returns {Array} The shuffled array.
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]; // Swap elements
            }
            return array;
        }

        // MODIFIED: Function to build and display the quiz
        function buildQuiz() {
            quizContainer.innerHTML = '';
            
            // Create a shuffled copy of the questions to not alter the original array
            const shuffledQuestions = shuffleArray([...quizData]);

            shuffledQuestions.forEach((currentQuestion, questionNumber) => {
                const questionDiv = document.createElement('div');
                questionDiv.classList.add('question-block');

                const questionTitle = document.createElement('h2');
                questionTitle.classList.add('text-lg', 'font-semibold', 'mb-4');
                questionTitle.innerText = `${questionNumber + 1}. ${currentQuestion.question}`;
                questionDiv.appendChild(questionTitle);

                const optionsDiv = document.createElement('div');
                optionsDiv.classList.add('grid', 'grid-cols-1', 'sm:grid-cols-2', 'gap-3');
                
                // Create a shuffled copy of the options for the current question
                const shuffledOptions = shuffleArray([...currentQuestion.options]);

                shuffledOptions.forEach(option => {
                    const button = document.createElement('button');
                    button.classList.add('quiz-option', 'w-full', 'p-3', 'text-left', 'border-2', 'border-gray-300', 'rounded-lg', 'hover:bg-gray-100', 'hover:border-blue-500', 'focus:outline-none', 'focus:ring-2', 'focus:ring-blue-400');
                    button.innerText = option;
                    // Pass the whole question object and the options container for context
                    button.onclick = () => selectAnswer(button, option, currentQuestion, optionsDiv);
                    optionsDiv.appendChild(button);
                });

                questionDiv.appendChild(optionsDiv);
                quizContainer.appendChild(questionDiv);
            });
        }

        // MODIFIED: Function to handle answer selection
        function selectAnswer(selectedButton, selectedOption, currentQuestion, optionsContainer) {
            const options = optionsContainer.querySelectorAll('.quiz-option');
            const correctAnswer = currentQuestion.answer;

            // Disable all buttons for this question to prevent changing the answer
            options.forEach(button => {
                button.disabled = true;
                if (button.innerText === correctAnswer) {
                    button.classList.add('correct');
                }
            });

            if (selectedOption !== correctAnswer) {
                selectedButton.classList.add('incorrect');
            } else {
                score++;
            }

            questionsAnswered++;

            // Check if all questions have been answered
            if (questionsAnswered === quizData.length) {
                showResults();
            }
        }

        // Function to display the final score
        function showResults() {
            scoreText.innerText = `You scored ${score} out of ${quizData.length}!`;
            resultsContainer.classList.remove('hidden');
        }

        // Function to reset the quiz
        function redoQuiz() {
            score = 0;
            questionsAnswered = 0;
            resultsContainer.classList.add('hidden');
            
            // Re-build the quiz to get a new random order
            buildQuiz();

            quizContainer.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Event listener for the redo button
        redoBtn.addEventListener('click', redoQuiz);

        // Initialize the quiz when the page loads
        document.addEventListener('DOMContentLoaded', buildQuiz);
    </script>
</body>
</html>